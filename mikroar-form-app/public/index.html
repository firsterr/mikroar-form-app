<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Form seçin</title>
<link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header class="container">
    <h1>Form seçin</h1>
    <p>Aktif formlar listelenir. Bir form seçince <code>/f/:slug</code> ile anket sayfasına gidilir.</p>
  </header>

  <main class="container">
    <div class="card">
      <select id="slugSelect" class="w-full">
        <option value="">— Yükleniyor… —</option>
      </select>
      <div class="row mt-2">
        <button id="openBtn" class="btn-primary">Formu aç</button>
        <button id="copyBtn" class="btn">Bağlantıyı kopyala</button>
      </div>
    </div>
  </main>

<script>
(async () => {
  const sel = document.getElementById('slugSelect');
  const openBtn = document.getElementById('openBtn');
  const copyBtn = document.getElementById('copyBtn');

  try {
    const r = await fetch('/api/forms-list', { cache: 'no-store' });
    const d = await r.json();
    sel.innerHTML = '';
    (d.rows || []).forEach(f => {
      const opt = document.createElement('option');
      opt.value = f.slug;
      opt.textContent = f.title || f.slug;
      sel.appendChild(opt);
    });
    if (!sel.value && sel.options.length) sel.selectedIndex = 0;
  } catch (e) {
    sel.innerHTML = '<option value="">Liste alınamadı</option>';
  }

  openBtn.addEventListener('click', () => {
    const slug = sel.value;
    if (!slug) return;
    location.href = `/f/${encodeURIComponent(slug)}`; // SSR hızlı
    // Eski yol istersen:
    // location.href = `/form.html?slug=${encodeURIComponent(slug)}`
  });

  copyBtn.addEventListener('click', async () => {
    const slug = sel.value;
    if (!slug) return;
    const url = `${location.origin}/f/${encodeURIComponent(slug)}`;
    await navigator.clipboard.writeText(url);
    copyBtn.textContent = 'Kopyalandı ✓';
    setTimeout(() => copyBtn.textContent = 'Bağlantıyı kopyala', 1500);
  });
})();
</script>
</body>
</html>
