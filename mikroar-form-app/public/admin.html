<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Admin Panel - Anket Oluştur</title>
<style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; }
    h1 { text-align: center; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    textarea, input { width: 100%; padding: 5px; margin-top: 5px; }
    button { margin-top: 15px; padding: 10px 20px; }
    .question { margin-bottom: 15px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
</style>
</head>
<body>

<h1>Admin Panel - Anket Oluştur</h1>

<label>Form Slug (benzersiz isim)</label>
<input type="text" id="slug" placeholder="anket-2025">

<label>Başlık</label>
<input type="text" id="title" placeholder="Anket Başlığı">

<h3>Sorular</h3>
<div id="questions"></div>
<button onclick="addQuestion()">Soru Ekle</button>

<button onclick="saveForm()">Kaydet</button>

<script>
let questions = [];

function addQuestion() {
    const index = questions.length;
    const qDiv = document.createElement("div");
    qDiv.className = "question";
    qDiv.innerHTML = `
        <label>Soru ${index+1}</label>
        <input type="text" placeholder="Soru metni" class="q-text">
        <label>Cevap Tipi</label>
        <select class="q-type">
            <option value="text">Metin</option>
            <option value="radio">Tek Seçim</option>
            <option value="checkbox">Çoklu Seçim</option>
        </select>
        <label>Seçenekler (virgülle ayırın)</label>
        <input type="text" class="q-options" placeholder="Evet,Hayır,Belki">
    `;
    document.getElementById("questions").appendChild(qDiv);
    questions.push({});
}

async function saveForm() {
    const slug = document.getElementById("slug").value.trim();
    const title = document.getElementById("title").value.trim();
    const schema = [];

    document.querySelectorAll(".question").forEach(q => {
        schema.push({
            text: q.querySelector(".q-text").value,
            type: q.querySelector(".q-type").value,
            options: q.querySelector(".q-options").value.split(",").map(o => o.trim()).filter(o => o)
        });
    });

    const res = await fetch("/admin/api/forms", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Basic " + btoa(prompt("Admin kullanıcı adı:") + ":" + prompt("Admin şifre:"))
        },
        body: JSON.stringify({
            slug,
            title,
            schema,
            active: true
        })
    });

    const data = await res.json();
    if (data.ok) {
        alert("Form kaydedildi!");
    } else {
        alert("Hata oluştu.");
    }
}
</script>

</body>
</html>
